<!-- Code used from Assignment 3 Code examples -->

<head>
    
    <script>

var cart = sessionStorage; //setting variable cart 
    var quantities = []; //setting a quantity variable 

    //if cart has information 
    if (cart.length == 0) { 
        history.go(-1); // goes back to previous page if empty 
        alert('Shopping Cart is Empty! Please Select Products'); 
    };

    //function made with help from w3school.com 
    function getCookie(cname) {
        var name = cname + "=";
        var decodedCookie = decodeURIComponent(document.cookie); //decodes cookie
        var ca = decodedCookie.split(';'); 
        for (var i = 0; i < ca.length; i++) { 
            var c = ca[i];
            while (c.charAt(0) == ' ') {
                c = c.substring(1);
            }
            if (c.indexOf(name) == 0) {
                return c.substring(name.length, c.length);
            }
        }
        return "";
    };
    //function to change product amount by positive 1 in cart 
    function addItem(theProduct, theIndex) { 
        var thisRowQty = parseInt(sessionStorage.getItem(`${theProduct}${theIndex}`)); 
        thisRowQty += 1; //adds 1
        sessionStorage.setItem(`${theProduct}${theIndex}`, thisRowQty); //gives the new value to the session 
        window.location.reload(); //reloads the page 
    };
    //function to change product amount by negative 1 in cart 
    function removeItem(theProduct, theIndex) { 
        var thisRowQty = parseInt(sessionStorage.getItem(`${theProduct}${theIndex}`)); 
        if (thisRowQty > 0) { 
            thisRowQty -= 1; //subtract 1
            sessionStorage.setItem(`${theProduct}${theIndex}`, thisRowQty); //gives the session the new value 
            window.location.reload(); //reloads the page 
        }

    };

    //made with help from stackoverflow.com 
    function GoBackWithRefresh(event) { //takes you back to previous page
        var past = document.referrer;
        var pastPage = past.split('/').pop(); 

        if (pastPage != 'login.html' && pastPage != 'register.html' && pastPage != 'cart.html') { 
            window.location = past;
        } else if (pastPage == 'login.html' && pastPage == 'register.html' && pastPage == 'cart.html') {
            window.history.go(-2); //go back 2 pages instead of to that last page if it was login, cart or register
        } else {
            window.location.href = './index.html'; //takes you to home page
        }
    };
//insures that the cart has proper data and that the user is logged in 
    function checkCart() {
        if (cart.length == 0) {
            window.location.reload();
        } else if (theUsername == '') {
            alert(`Please log in before viewing cart`);
            window.location.href = './login.html';
        } else {
            fetch("/generateInvoice?cartData="+JSON.stringify(cart)+"&cookieData="+JSON.stringify(document.cookie), 
            {
                method: "POST"
            }).then(function (res) {
                return res.text();
            }).then(function (data) {
                document.write(data);
            })
        }
    }

    </script>
</head>

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="author" content="Tyler Johnson">
    <meta name="description" content="Displays products">
    <!-- Add responsive design on smaller screens -->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Import Bootstrap CSS library -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <!-- Own CSS style -->
    <link rel="stylesheet" href="css/style.css">
    <title>Lululemon Store</title>
</head>

<body>

    <form name="form" action="purchase_submit_button" method="POST">

        <!-- Navigation Bar -->
        <nav class="navbar navbar-expand-sm navbar-light bg-light">
            <a class="navbar-brand" href="#">
                <img src="./imgs/logo.png" width="30" height="30" class="d-inline-block align-top" alt="">
            </a>
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="#">Marcus and Tyler's Lululemon Store :)</a>
                    </li>


                    <li class="nav-item">
                        <a class="nav-link" href="#">|</a>
                    </li>
                    <li class="nav-item ml-auto">
                        <a class="nav-link" href="#">ITM 352</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">|</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">HOME</a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" href="index_shirts.html">SHIRTS</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="index_pants.html">PANTS</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="index_acc.html">ACCESSORIES</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="index_bags.html">BAGS</a>
                    </li>

                </ul>
            </div>
        </nav>

        <!-- Main Content Of Page -->

        <div class="container">
            <div class="row justify-content-center text-center">
                <div class="log-in">

                    <head>
                        

                    </head>
                    <h2>You have <span id="cart_total">0</span> items in your shopping cart</h2>
                    <script>
                        cart_total.innerHTML = total;
                    // This function takes a string assumed to be a key in the products array above to display and select the corresponding products
                        var order_str = '';
                    
                        order_str += `<h1>Please select what ${this_product_key} you want</h1><br>`;
                        // We put the whole table in the form so that anything entered in it will get submitted
                        order_str += `<FORM action="/add_to_cart" method="GET">
                                    <INPUT TYPE="HIDDEN" NAME="products_key" VALUE="${this_product_key}">
                                        <TABLE BORDER>
                                            <TR><TD><B><BIG>Description</TD><TD><B><BIG>Price</TD><TD><B><BIG>Quantity Desired</TD></TR>`;
                        products = products_data[this_product_key];
                        for (i = 0; i < products.length; i++) {
                            order_str += `<TR><TD>${products[i]['name']}</TD><TD>${products[i]['price']}</TD><TD>
                                        <INPUT TYPE="TEXT"  name="quantities[${i}]" value="${(typeof shopping_cart[this_product_key]!='undefined')?shopping_cart[products_key][i]:0}"></TD></TR>`;
                        }
                        order_str += `</TABLE><br>
                        <INPUT TYPE="SUBMIT"  name="Submit" value="Select">
                        </FORM>`;
                        document.write(order_str);
                    </script>
                </div>
            </div>
        </div>
    </form>
</body>

</html>